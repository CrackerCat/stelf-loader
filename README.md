# stelf-loader
A stealthy ELF loader - no files, no execve, no RWX

This implementation currently relies on some hand-written x86-64 shellcode, but the
general technique should be applicable cross-architecture.

The current implementation only works `static-pie` ELFs.
It should also be possible to work with non-pie static ELFs, but dynamic ELFs are out of scope for this project.

## Bash self-injecting shellcode loader

Using some clever tricks (TODO: explain), we instruct Bash to
load some shellcode into itself, ultimately using `dd` to write to `/proc/self/mem`.
We inject a small fragment of shellcode, which in turn loads a much larger piece
of shellcode. The larger shellcode is generated by...

## `elf_to_shellcode.py`

This is usable as a standalone script. It flattens a static-pie
elf into a piece of shellcode. This is similar to what [gamozolabs/elfloader](https://github.com/gamozolabs/elfloader) does,
except it also generates a shellcode stub that sets up the correct page permissions.
This avoids needing RWX mappings.

## `elf_to_stelf.py`

This script ties together all the aforementioned tricks. It takes a static-pie ELF as input, and outputs a (potentially extremely long) bash one-liner.

## TODO

- mmap and pivot to a fresh stack
- add more options to `elf_to_shellcode.py`
